trigger:
  branches:
    include:
      - main

variables:
  - group: WebAppVariables

jobs:
- job: Build
  displayName: 'Build and Publish Artifact'
  pool:
    vmImage: 'ubuntu-latest'
  steps:
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.'
        addToPath: true
        pythonLocation: 'GitHub'
        githubEndpoint: 'maneabhishekk' 
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.'  
        addToPath: true
    - script: |
        python -m venv venv
        venv\Scripts\activate
        pip install -r requirements.txt
        pip install pytest
        pytest
    - task: ArchiveFiles@2
      displayName: 'Archive files'
      inputs:
        rootFolderOrFile: '$(Build.SourcesDirectory)'
        includeRootFolder: false
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
    - publish: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
      displayName: 'Publish Artifact'
      artifact: drop
