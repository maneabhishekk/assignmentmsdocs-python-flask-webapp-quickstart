trigger:
  branches:
    include:
      - main

variables:
  - group: WebAppVariables

jobs:
- job: Build
  displayName: 'Build and Publish Artifact'
  pool:
    vmImage: 'ubuntu-latest'
  steps:
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.8'  
        addToPath: true
        pythonLocation: 'Auto'  
    - script: |
        python -m venv venv
        source venv/bin/activate
        python -m pip install --upgrade pip 
        pip install -r requirements.txt
        pip install pytest
        pytest
    - task: ArchiveFiles@2
      displayName: 'Archive files'
      inputs:
        rootFolderOrFile: '$(Build.SourcesDirectory)'
        includeRootFolder: false
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
    - publish: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
      displayName: 'Publish Artifact'
      artifact: drop
